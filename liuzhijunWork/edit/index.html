<!DOCTYPE html>
<html>
<head lang="zh_cn">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=320, user-scalable=no, initial-scale=1.0, maximum-scale=1.0">
    <title></title>
    <link href="styles/reset.css" rel="stylesheet" />
	<!--codemirror-->
    <link href="scripts/codemirror/lib/codemirror.css" rel="stylesheet" />
	<script src="scripts/codemirror/lib/codemirror.js"></script>
	<script src="scripts/codemirror/addon/edit/closetag.js"></script>
	<script src="scripts/codemirror/addon/fold/xml-fold.js"></script>
	<script src="scripts/codemirror/mode/xml/xml.js"></script>
	<script src="scripts/codemirror/mode/javascript/javascript.js"></script>
	<script src="scripts/codemirror/mode/css/css.js"></script>
	<script src="scripts/codemirror/mode/htmlmixed/htmlmixed.js"></script>

	<!--menu-->
    <link href="../menu/styles/menu.css" rel="stylesheet" />
	<script src="../menu/scripts/AjaxUtil.js"></script>

	<!--layout-->
    <link href="styles/layout.css" rel="stylesheet" />
</head>
<body>
	<div class="page">
		<div id="frame" class="frame"></div>
		<div class="content">
			<div class="tools">
				<label>背景颜色:</label><input onchange="changeColor(this)" id="color" type="color" />
				<label>切换模式:</label>
				<select id="lang" onchange="changeMode(this)">
					<option value="javascript">javascript</option>
					<option value="css">css</option>
					<option value="text/html">html</option>
				</select>
				<input onclick="reset(this)" id="reset" type="button" value="重新设置" />
			</div>
			<textarea id="code"></textarea>
		</div>
	</div>
	<script type="text/template" id="tree_template">
		<nav class="tree_menu">
			<input type="checkbox" id="clickBox">
			<label class="tree_menu_thumb" for="clickBox"><div></div></label>
			<ul>
				<%data.forEach(function(item,index){%>
					<li>
						<a href="<%=item.url%>"><%=item.text%></a>
						<%if(item.children && item.children.length){%>
							<ul>
								<%item.children.forEach(function(citem,index){%>
									<li><a href="<%=citem.url%>"><%=citem.text%></a></li>
								<%});%>
							</ul>
						<%}%>
					</li>
				<%});%>
			</ul>
		</nav>
	</script>
	<script src="../menu/scripts/main.js"></script>
</body>
</html>
<script>
var G=function(id){
	return document.getElementById(id);
}
var Q=function(selector){
	return document.querySelector(selector);
}
var code = G('code');
var defOpt = {
    lineNumbers: true,
    mode: 'text/html',
    autoCloseTags: true
}
var editor = CodeMirror.fromTextArea(code,defOpt);

function setValue(value){
	editor.setValue(value);
}

function getValue(){
	return editor.getValue();
}

var defColor = '#DCDCDC';
function changeMode(el){
	editor.setOption("mode",el.value);
	localStorage.codemirrormode=el.value;
}

function changeColor(el){
	Q('.CodeMirror').style.backgroundColor=el.value;
	localStorage.codemirrorbg=el.value;
}

function reset(){
	var lang = G('lang');
	var color = G('color');
	lang.value = defOpt.mode;
	color.value = defColor;
	lang.onchange();
	color.onchange();
}

function init(){
	if(localStorage.codemirrorbg) {
		var el = G('color');
		el.value = localStorage.codemirrorbg;
		el.onchange();
	}
	if(localStorage.codemirrormode){
		var el = G('lang');
		el.value = localStorage.codemirrormode;
		el.onchange();
	}
}

init();
</script>
